%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This document can be formatted only with pdflatex.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% TODO use the T-CREST template here

\documentclass[11pt,twoside,a4paper]{report}
\usepackage[margin=1.1in]{geometry}

\usepackage[T1]{fontenc}
\usepackage{ae}
\usepackage[pdftex]{graphicx}
\usepackage[english]{babel}
\usepackage{latexsym,epsf,epsfig}
\usepackage{rotating,amsmath,amsfonts,amssymb,subfigure}
\usepackage{amsthm}

\usepackage{times}
\usepackage{listings}
\usepackage{longtable}
\usepackage{datetime}
\usepackage{verbatim}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{array}

\usepackage{booktabs}
\usepackage{dcolumn}

\usepackage{pslatex} % -- times instead of computer modern
\usepackage{url}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xspace}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{colortbl}
\usepackage{multicol}

\usepackage{bytefield}

\usepackage{todonotes}
%\usepackage[disable]{todonotes}

\newcommand{\note}[2][]{\todo[color=green,inline,#1]{#2}}

\newcommand{\cc}[1]{\multicolumn{1}{c}{#1}}
\newcolumntype{d}[1]{D{.}{.}{#1}}
\newcommand{\code}[1]{{\texttt{#1}}}
\newcommand{\codefoot}[1]{{\texttt{#1}}}
\newcommand{\eg}{\emph{e.g.}}
\newcommand{\ie}{\emph{i.e.}}

\usepackage{listings}
\lstset{language=C,basicstyle=\footnotesize,captionpos=b}
%% \renewcommand{\lstlistingname}{\footnotesize Listing}

\newtheorem{lemma}{Lemma}
\newtheorem{theorem}{Theorem}
\newtheorem{criterion}{Criterion}
\newtheorem{definition}{Definition}

% TODO move the ISA related stuff into the isa.tex file

% long immediate in second slot
\newcommand{\lconst}{\texttt{const}_{32}}
% short immediate in ALU instruction
\newcommand{\sconst}{\texttt{Constant}_{12}}
% constant in Rs2 field
\newcommand{\rconst}{\texttt{Constant}_{5}}

\newcommand{\XOR}{\textasciicircum\xspace}
\newcommand{\OR}{\textbar\xspace}
\newcommand{\AND}{\&\xspace}
\newcommand{\NOT}{\texttildelow}
\newcommand{\shl}{\textless$\!$\textless\xspace}
\newcommand{\shr}{\textgreater$\!$\textgreater$\!$\textgreater\xspace}
\newcommand{\ashr}{\textgreater$\!$\textgreater\xspace}

%
% allow click-able links
%
\usepackage[open]{bookmark}
% should be the last package:
\usepackage{hyperref}
% fix jumping to caption instead of figure
\usepackage[all]{hypcap}

% \pdfcatalog{
%  /UseNone
% }

\title{The Patmos Tool Chain Manual}

\begin{document}

%\firstpage
\maketitle

\newpage
\tableofcontents

\newpage

\cleardoublepage
%\pagenumbering{arabic}


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % 

% TODO
% - move (inline) asm stuff from patmos_tr here
% - remove stuff from here that is already in READMEs and should not be repeated here (manual building without build.sh, ..)
% - move patmos-misc/doc/*.txt stuff into content, convert to tex
% - use the T-CREST template style
% - Somehow copy the ISA part from TR to here, fix formatting.
% - clean up this whole mess, make sure everything is consistent/up-to-date


\chapter{Introduction}
% All the buzzwords and the motivation go here.


\chapter{Platform Overview}
% This chapter should give the big picture and some motivation. Maybe call this chapter something else 
% and create sections 'Time-Predictability', 'Model of Computation', 'Platform Overview', ... 


\chapter{Description of the Platform Components}
% This should contain a per-component (CPU, Compiler Tool Chain, WCET Analysis + Platin, NoC, ..) 
% 'in-depth' high-level description (no technical details like ISA, asm format or actual tool usage, but 
% a more detailed description of the architecture and the inner workings, plus references to the related
% specification sections/chapters.

% Section: Patmos Processor

% Section: Compiler Tool Chain

% TODO needs cleanup, currently not fully up-to-date.
\input{content/overview_compiler}

% Section: WCET Analysis and Platin Toolkit

% Section: Operating System


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
% Now we have chapters with the main references and specs
% The specs will be large, so they actually should be chapters, not just sections,
% so there is no single top-level 'Reference' chapter.

\chapter{Patmos Architecture Reference}

% TODO Ok, now this looks properly horrible without the two-column formatting. Needs cleanup.
% TODO we also need a good way to keep this in sync with the TR.. maybe split the TR into files 
% or export the TR as PDF and only link in the PDF here?
\input{content/isa}

% TODO Section: IO Interfaces (UART, ..)

% TODO Section: ELF Format


\chapter{Libraries and Operating Systems}

% Section Target Triples, ..

% Section Build system (patmos-toolchain.cmake)

% Section Newlib stuff (SPM, UART, ..)

% Section RTEMS


\chapter{Compiler Tool Chain Reference}

% Section: Clang C Frontend

% Section: LLVM Backend


\chapter{Platin Toolkit Reference}

% Section: PML format

% Section: Flow Fact Annotations, Tools, ...



% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\chapter{Installation and Usage}
% This chapter should contain a high-level view of the installation and usage procedures.
% The details should go into the README.patmos files and should only be referenced from here,
% to minimize duplication. E.g, we describe the build.sh script here, the requirements, and some commonly used options,
% but full configure strings for manual installation and lesser used options should be (together with common options) 
% in README.patmos.


% Section: Compiler Tool Chain Installation and Usage

% TODO clean up, remove manual installation stuff as it is already in README.patmos, just add referene to files.
\input{content/usage_compiler}

% This section should probably also contain infos about platin installation and usage (?)


% Section: Synthesizing and Booting Patmos


% Section: RTEMS (?)


\chapter{Examples}
% This chapter is intended for all sorts of longer usage examples, maybe a bigger running example.

\input{content/examples}



%\chapter*{Appendix}
%\appendix
% Changelog, internals, ... 



% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %
\cleardoublepage

\nocite{Kirner:RTS2010}
\nocite{FFY05}
\nocite{patmos:ppes2011}

\bibliographystyle{plain}

\bibliography{references}

\end{document}
